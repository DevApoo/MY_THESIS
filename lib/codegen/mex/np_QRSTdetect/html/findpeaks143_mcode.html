<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="43,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type0" id="S2T0U3">Ypk</span>,<span class="var type0" id="S3T0U4">Xpk</span>,<span class="var type0" id="S4T0U5">Wpk</span>,<span class="var type0" id="S5T0U6">Ppk</span>] = findpeaks(<span class="var type1" id="S6T2U9">Yin</span>,<span class="var type1" id="S7T21U10">varargin</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%FINDPEAKS Find local peaks in data</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%   PKS = FINDPEAKS(Y) finds local peaks in the data vector Y. A local peak</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%   is defined as a data sample which is either larger than the two</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%   neighboring samples or is equal to Inf.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%   [PKS,LOCS]= FINDPEAKS(Y) also returns the indices LOCS at which the</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%   peaks occur.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%   [PKS,LOCS] = FINDPEAKS(Y,X) specifies X as the location vector of data</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%   vector Y. X must be a strictly increasing vector of the same length as</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%   Y. LOCS returns the corresponding value of X for each peak detected.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%   If X is omitted, then X will correspond to the indices of Y.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%   [PKS,LOCS] = FINDPEAKS(Y,Fs) specifies the sample rate, Fs, as a</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%   positive scalar, where the first sample instant of Y corresponds to a</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%   time of zero.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%   [<span class="keyword">...</span><span class="comment">] = FINDPEAKS(...,'MinPeakHeight',MPH) finds only those peaks that</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%   are greater than the minimum peak height, MPH. MPH is a real-valued</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%   scalar. The default value of MPH is -Inf.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%   [<span class="keyword">...</span><span class="comment">] = FINDPEAKS(...,'MinPeakProminence',MPP) finds peaks guaranteed</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%   to have a vertical drop of more than MPP from the peak on both sides</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%   without encountering either the end of the signal or a larger</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%   intervening peak. The default value of MPP is zero.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%   [<span class="keyword">...</span><span class="comment">] = FINDPEAKS(...,'Threshold',TH) finds peaks that are at least</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%   greater than both adjacent samples by the threshold, TH. TH is a</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%   real-valued scalar greater than or equal to zero. The default value of</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%   TH is zero.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%   FINDPEAKS(<span class="keyword">...</span><span class="comment">,'WidthReference',WR) estimates the width of the peak as</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%   the distance between the points where the signal intercepts a</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%   horizontal reference line. The points are found by linear</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%   interpolation. The height of the line is selected using the criterion</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%   specified in WR:</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="43,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">%    'halfprom' - the reference line is positioned beneath the peak at a</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">%       vertical distance equal to half the peak prominence.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="43,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%    'halfheight' - the reference line is positioned at one-half the peak </span></span></span>
<span class="srcline"><span class="lineno"><a href="43,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">%       height. The line is truncated if any of its intercept points lie</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">%       beyond the borders of the peaks selected by the 'MinPeakHeight',</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">%       'MinPeakProminence' and 'Threshold' parameters. The border between</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%       peaks is defined by the horizontal position of the lowest valley</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">%       between them. Peaks with heights less than zero are discarded.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="43,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">%    The default value of WR is 'halfprom'.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">%   [<span class="keyword">...</span><span class="comment">] = FINDPEAKS(...,'MinPeakWidth',MINW) finds peaks whose width is</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">%   at least MINW. The default value of MINW is zero.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">%   [<span class="keyword">...</span><span class="comment">] = FINDPEAKS(...,'MaxPeakWidth',MAXW) finds peaks whose width is</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">%   at most MAXW. The default value of MAXW is Inf.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,57" id="srcline57"> 57</a></span><span class="line"><span class="comment">%   [<span class="keyword">...</span><span class="comment">] = FINDPEAKS(...,'MinPeakDistance',MPD) finds peaks separated by</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">%   more than the minimum peak distance, MPD. This parameter may be</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">%   specified to ignore smaller peaks that may occur in close proximity to</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">%   a large local peak. For example, if a large local peak occurs at LOC,</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">%   then all smaller peaks in the range [N-MPD, N+MPD] are ignored. If not</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">%   specified, MPD is assigned a value of zero.  </span></span></span>
<span class="srcline"><span class="lineno"><a href="43,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">%   [<span class="keyword">...</span><span class="comment">] = FINDPEAKS(...,'SortStr',DIR) specifies the direction of sorting</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">%   of peaks. DIR can take values of 'ascend', 'descend' or 'none'. If not</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">%   specified, DIR takes the value of 'none' and the peaks are returned in</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,67" id="srcline67"> 67</a></span><span class="line"><span class="comment">%   the order of their occurrence.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">%   [<span class="keyword">...</span><span class="comment">] = FINDPEAKS(...,'NPeaks',NP) specifies the maximum number of peaks</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%   to be found. NP is an integer greater than zero. If not specified, all</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%   peaks are returned. Use this parameter in conjunction with setting the</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">%   sort direction to 'descend' to return the NP largest peaks. (see</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,73" id="srcline73"> 73</a></span><span class="line"><span class="comment">%   'SortStr')</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,74" id="srcline74"> 74</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">%   [PKS,LOCS,W] = FINDPEAKS(<span class="keyword">...</span><span class="comment">) returns the width, W, of each peak by</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,76" id="srcline76"> 76</a></span><span class="line"><span class="comment">%   linear interpolation of the left- and right- intercept points to the</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,77" id="srcline77"> 77</a></span><span class="line"><span class="comment">%   reference defined by 'WidthReference'.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,78" id="srcline78"> 78</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,79" id="srcline79"> 79</a></span><span class="line"><span class="comment">%   [PKS,LOCS,W,P] = FINDPEAKS(<span class="keyword">...</span><span class="comment">) returns the prominence, P, of each</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,80" id="srcline80"> 80</a></span><span class="line"><span class="comment">%   peak.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,81" id="srcline81"> 81</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">%   FINDPEAKS(<span class="keyword">...</span><span class="comment">) without output arguments plots the signal and the peak</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">%   values it finds</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,84" id="srcline84"> 84</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">%   FINDPEAKS(<span class="keyword">...</span><span class="comment">,'Annotate',PLOTSTYLE) will annotate a plot of the</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">%   signal with PLOTSTYLE. If PLOTSTYLE is 'peaks' the peaks will be</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,87" id="srcline87"> 87</a></span><span class="line"><span class="comment">%   plotted. If PLOTSTYLE is 'extents' the signal, peak values, widths,</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,88" id="srcline88"> 88</a></span><span class="line"><span class="comment">%   prominences of each peak will be annotated. 'Annotate' will be ignored</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,89" id="srcline89"> 89</a></span><span class="line"><span class="comment">%   if called with output arguments. The default value of PLOTSTYLE is</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,90" id="srcline90"> 90</a></span><span class="line"><span class="comment">%   'peaks'.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,91" id="srcline91"> 91</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,92" id="srcline92"> 92</a></span><span class="line"><span class="comment">%   % Example 1:</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,93" id="srcline93"> 93</a></span><span class="line"><span class="comment">%   %   Plot the Zurich numbers of sunspot activity from years 1700-1987</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,94" id="srcline94"> 94</a></span><span class="line"><span class="comment">%   %   and identify all local maxima at least six years apart</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,95" id="srcline95"> 95</a></span><span class="line"><span class="comment">%   load sunspot.dat</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,96" id="srcline96"> 96</a></span><span class="line"><span class="comment">%   findpeaks(sunspot(:,2),sunspot(:,1),'MinPeakDistance',6)</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,97" id="srcline97"> 97</a></span><span class="line"><span class="comment">%   xlabel('Year');</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,98" id="srcline98"> 98</a></span><span class="line"><span class="comment">%   ylabel('Zurich number');</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,99" id="srcline99"> 99</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,100" id="srcline100">100</a></span><span class="line"><span class="comment">%   % Example 2: </span></span></span>
<span class="srcline"><span class="lineno"><a href="43,101" id="srcline101">101</a></span><span class="line"><span class="comment">%   %   Plot peak values of an audio signal that drop at least 1V on either</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,102" id="srcline102">102</a></span><span class="line"><span class="comment">%   %   side without encountering values larger than the peak.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,103" id="srcline103">103</a></span><span class="line"><span class="comment">%   load mtlb</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,104" id="srcline104">104</a></span><span class="line"><span class="comment">%   findpeaks(mtlb,Fs,'MinPeakProminence',1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,105" id="srcline105">105</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,106" id="srcline106">106</a></span><span class="line"><span class="comment">%   % Example 3:</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,107" id="srcline107">107</a></span><span class="line"><span class="comment">%   %   Plot all peaks of a chirp signal whose widths are between .5 and 1 </span></span></span>
<span class="srcline"><span class="lineno"><a href="43,108" id="srcline108">108</a></span><span class="line"><span class="comment">%   %   milliseconds.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,109" id="srcline109">109</a></span><span class="line"><span class="comment">%   Fs = 44.1e3; N = 1000;</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,110" id="srcline110">110</a></span><span class="line"><span class="comment">%   x = sin(2*pi*(1:N)/N + (10*(1:N)/N).^2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,111" id="srcline111">111</a></span><span class="line"><span class="comment">%   findpeaks(x,Fs,'MinPeakWidth',.5e-3,'MaxPeakWidth',1e-3, <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,112" id="srcline112">112</a></span><span class="line"><span class="comment">%             'Annotate','extents')</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,113" id="srcline113">113</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,114" id="srcline114">114</a></span><span class="line"><span class="comment">%   See also MAX, FINDCHANGEPTS.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,115" id="srcline115">115</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,116" id="srcline116">116</a></span><span class="line"><span class="comment">%   Copyright 2007-2015 The MathWorks, Inc.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,117" id="srcline117">117</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,118" id="srcline118">118</a></span><span class="line"><span class="comment">%#ok&lt;*EMCLS&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,119" id="srcline119">119</a></span><span class="line"><span class="comment">%#ok&lt;*EMCA&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,120" id="srcline120">120</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,121" id="srcline121">121</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,122" id="srcline122">122</a></span><span class="line"><span class="mxinfo " id="T6:U3"><span class="var type1" id="S8T6U13">cond</span> = <span class="mxinfo " id="T6:U5">nargin &gt;= 1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,123" id="srcline123">123</a></span><span class="line"><span class="keyword">if</span> ~<span class="var type1" id="S8T6U21">cond</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,124" id="srcline124">124</a></span><span class="line">    coder.internal.assert(<span class="var type0" id="S8T0U29">cond</span>,<span class="string">'MATLAB:narginchk:notEnoughInputs'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,125" id="srcline125">125</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,126" id="srcline126">126</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,127" id="srcline127">127</a></span><span class="line"><span class="mxinfo " id="T6:U7"><span class="var type1" id="S8T6U33">cond</span> = <span class="mxinfo " id="T6:U9">nargin &lt;= 22</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,128" id="srcline128">128</a></span><span class="line"><span class="keyword">if</span> ~<span class="var type1" id="S8T6U41">cond</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,129" id="srcline129">129</a></span><span class="line">    coder.internal.assert(<span class="var type0" id="S8T0U49">cond</span>,<span class="string">'MATLAB:narginchk:tooManyInputs'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,130" id="srcline130">130</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,131" id="srcline131">131</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,132" id="srcline132">132</a></span><span class="line"><span class="comment">% extract the parameters from the input argument list</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,133" id="srcline133">133</a></span><span class="line"><span class="message error" id="M9F143C">[<span class="var type0" id="S11T0U54">y</span>,<span class="var type0" id="S12T0U55">yIsRow</span>,<span class="var type0" id="S13T0U56">x</span>,<span class="var type0" id="S14T0U57">xIsRow</span>,<span class="var type0" id="S15T0U58">minH</span>,<span class="var type0" id="S16T0U59">minP</span>,<span class="var type0" id="S17T0U60">minW</span>,<span class="var type0" id="S18T0U61">maxW</span>,<span class="var type0" id="S19T0U62">minD</span>,<span class="var type0" id="S20T0U63">minT</span>,<span class="var type0" id="S21T0U64">maxN</span>,<span class="var type0" id="S22T0U65">sortDir</span>,<span class="var type0" id="S23T0U66">annotate</span>,<span class="var type0" id="S24T0U67">refW</span>] <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,134" id="srcline134">134</a></span><span class="line">  = parse_inputs(<span class="var type1" id="S6T2U70">Yin</span>,<span class="mxinfo " id="T12:U12"><span class="var type1" id="S7T21U72">varargin</span>{:}</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,135" id="srcline135">135</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,136" id="srcline136">136</a></span><span class="line"><span class="comment">% find indices of all finite and infinite peaks and the inflection points</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,137" id="srcline137">137</a></span><span class="line">[<span class="var type0" id="S26T0U77">iFinite</span>,<span class="var type0" id="S27T0U78">iInfite</span>,<span class="var type0" id="S28T0U79">iInflect</span>] = getAllPeaks(<span class="var type0" id="S11T0U82">y</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,138" id="srcline138">138</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,139" id="srcline139">139</a></span><span class="line"><span class="comment">% keep only the indices of finite peaks that meet the required </span></span></span>
<span class="srcline"><span class="lineno"><a href="43,140" id="srcline140">140</a></span><span class="line"><span class="comment">% minimum height and threshold</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,141" id="srcline141">141</a></span><span class="line"><span class="var type0" id="S30T0U85">iPk</span> = removePeaksBelowMinPeakHeight(<span class="var type0" id="S11T0U88">y</span>,<span class="var type0" id="S26T0U89">iFinite</span>,<span class="var type0" id="S15T0U90">minH</span>,<span class="var type0" id="S24T0U91">refW</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,142" id="srcline142">142</a></span><span class="line"><span class="var type0" id="S30T0U94">iPk</span> = removePeaksBelowThreshold(<span class="var type0" id="S11T0U97">y</span>,<span class="var type0" id="S30T0U98">iPk</span>,<span class="var type0" id="S20T0U99">minT</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,143" id="srcline143">143</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,144" id="srcline144">144</a></span><span class="line"><span class="comment">% indicate if we need to compute the extent of a peak</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,145" id="srcline145">145</a></span><span class="line"><span class="var type0" id="S33T0U102">needWidth</span> = <span class="var type0" id="S17T0U108">minW</span>&gt;0 || <span class="var type0" id="S18T0U111">maxW</span>&lt;inf || <span class="var type0" id="S16T0U115">minP</span>&gt;0 || nargout&gt;2 || strcmp(<span class="var type0" id="S23T0U123">annotate</span>,<span class="string">'extents'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,146" id="srcline146">146</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,147" id="srcline147">147</a></span><span class="line"><span class="keyword">if</span> <span class="var type0" id="S33T0U127">needWidth</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,148" id="srcline148">148</a></span><span class="line">  <span class="comment">% obtain the indices of each peak (iPk), the prominence base (bPk), and</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,149" id="srcline149">149</a></span><span class="line">  <span class="comment">% the x- and y- coordinates of the peak base (bxPk, byPk) and the width</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,150" id="srcline150">150</a></span><span class="line">  <span class="comment">% (wxPk)</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,151" id="srcline151">151</a></span><span class="line">  [<span class="var type0" id="S30T0U131">iPk</span>,<span class="var type0" id="S37T0U132">bPk</span>,<span class="var type0" id="S38T0U133">bxPk</span>,<span class="var type0" id="S39T0U134">byPk</span>,<span class="var type0" id="S40T0U135">wxPk</span>] = findExtents(<span class="var type0" id="S11T0U138">y</span>,<span class="var type0" id="S13T0U139">x</span>,<span class="var type0" id="S30T0U140">iPk</span>,<span class="var type0" id="S26T0U141">iFinite</span>,<span class="var type0" id="S27T0U142">iInfite</span>,<span class="var type0" id="S28T0U143">iInflect</span>,<span class="var type0" id="S16T0U144">minP</span>,<span class="var type0" id="S17T0U145">minW</span>,<span class="var type0" id="S18T0U146">maxW</span>,<span class="var type0" id="S24T0U147">refW</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,152" id="srcline152">152</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,153" id="srcline153">153</a></span><span class="line">  <span class="comment">% combine finite and infinite peaks into one list</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,154" id="srcline154">154</a></span><span class="line">  [<span class="var type0" id="S30T0U152">iPk</span>,<span class="var type0" id="S37T0U153">bPk</span>,<span class="var type0" id="S38T0U154">bxPk</span>,<span class="var type0" id="S39T0U155">byPk</span>,<span class="var type0" id="S40T0U156">wxPk</span>] = combinePeaks(<span class="var type0" id="S30T0U159">iPk</span>,<span class="var type0" id="S27T0U160">iInfite</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,155" id="srcline155">155</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,156" id="srcline156">156</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,157" id="srcline157">157</a></span><span class="line"><span class="comment">% find the indices of the largest peaks within the specified distance</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,158" id="srcline158">158</a></span><span class="line"><span class="var type0" id="S43T0U163">idx</span> = findPeaksSeparatedByMoreThanMinPeakDistance(<span class="var type0" id="S11T0U166">y</span>,<span class="var type0" id="S13T0U167">x</span>,<span class="var type0" id="S30T0U168">iPk</span>,<span class="var type0" id="S19T0U169">minD</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,159" id="srcline159">159</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,160" id="srcline160">160</a></span><span class="line"><span class="comment">% re-order and bound the number of peaks based upon the index vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,161" id="srcline161">161</a></span><span class="line"><span class="var type0" id="S43T0U172">idx</span> = orderPeaks(<span class="var type0" id="S11T0U175">y</span>,<span class="var type0" id="S30T0U176">iPk</span>,<span class="var type0" id="S43T0U177">idx</span>,<span class="var type0" id="S22T0U178">sortDir</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,162" id="srcline162">162</a></span><span class="line"><span class="var type0" id="S43T0U181">idx</span> = keepAtMostNpPeaks(<span class="var type0" id="S43T0U184">idx</span>,<span class="var type0" id="S21T0U185">maxN</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,163" id="srcline163">163</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,164" id="srcline164">164</a></span><span class="line"><span class="comment">% use the index vector to fetch the correct peaks.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,165" id="srcline165">165</a></span><span class="line"><span class="var type0" id="S30T0U188">iPk</span> = <span class="var type0" id="S30T0U190">iPk</span>(<span class="var type0" id="S43T0U191">idx</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,166" id="srcline166">166</a></span><span class="line"><span class="keyword">if</span> <span class="var type0" id="S33T0U194">needWidth</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,167" id="srcline167">167</a></span><span class="line">  [<span class="var type0" id="S37T0U198">bPk</span>, <span class="var type0" id="S38T0U199">bxPk</span>, <span class="var type0" id="S39T0U200">byPk</span>, <span class="var type0" id="S40T0U201">wxPk</span>] = fetchPeakExtents(<span class="var type0" id="S43T0U204">idx</span>,<span class="var type0" id="S37T0U205">bPk</span>,<span class="var type0" id="S38T0U206">bxPk</span>,<span class="var type0" id="S39T0U207">byPk</span>,<span class="var type0" id="S40T0U208">wxPk</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,168" id="srcline168">168</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,169" id="srcline169">169</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,170" id="srcline170">170</a></span><span class="line"><span class="keyword">if</span> nargout &gt; 0</span></span>
<span class="srcline"><span class="lineno"><a href="43,171" id="srcline171">171</a></span><span class="line">  <span class="comment">% assign output variables</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,172" id="srcline172">172</a></span><span class="line">  <span class="keyword">if</span> <span class="var type0" id="S33T0U217">needWidth</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,173" id="srcline173">173</a></span><span class="line">    [<span class="var type0" id="S2T0U221">Ypk</span>,<span class="var type0" id="S3T0U222">Xpk</span>,<span class="var type0" id="S4T0U223">Wpk</span>,<span class="var type0" id="S5T0U224">Ppk</span>] = assignFullOutputs(<span class="var type0" id="S11T0U227">y</span>,<span class="var type0" id="S13T0U228">x</span>,<span class="var type0" id="S30T0U229">iPk</span>,<span class="var type0" id="S40T0U230">wxPk</span>,<span class="var type0" id="S37T0U231">bPk</span>,<span class="var type0" id="S12T0U232">yIsRow</span>,<span class="var type0" id="S14T0U233">xIsRow</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,174" id="srcline174">174</a></span><span class="line">  <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,175" id="srcline175">175</a></span><span class="line">    [<span class="var type0" id="S2T0U238">Ypk</span>,<span class="var type0" id="S3T0U239">Xpk</span>] = assignOutputs(<span class="var type0" id="S11T0U242">y</span>,<span class="var type0" id="S13T0U243">x</span>,<span class="var type0" id="S30T0U244">iPk</span>,<span class="var type0" id="S12T0U245">yIsRow</span>,<span class="var type0" id="S14T0U246">xIsRow</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,176" id="srcline176">176</a></span><span class="line">  <span class="keyword">end</span>    </span></span>
<span class="srcline"><span class="lineno"><a href="43,177" id="srcline177">177</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,178" id="srcline178">178</a></span><span class="line">  <span class="comment">% no output arguments specified. plot and optionally annotate</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,179" id="srcline179">179</a></span><span class="line">  <span class="var type0" id="S50T0U250">hAxes</span> = plotSignalWithPeaks(<span class="var type0" id="S13T0U253">x</span>,<span class="var type0" id="S11T0U254">y</span>,<span class="var type0" id="S30T0U255">iPk</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,180" id="srcline180">180</a></span><span class="line">  <span class="keyword">if</span> strcmp(<span class="var type0" id="S23T0U260">annotate</span>,<span class="string">'extents'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,181" id="srcline181">181</a></span><span class="line">    plotExtents(<span class="var type0" id="S50T0U265">hAxes</span>,<span class="var type0" id="S13T0U266">x</span>,<span class="var type0" id="S11T0U267">y</span>,<span class="var type0" id="S30T0U268">iPk</span>,<span class="var type0" id="S37T0U269">bPk</span>,<span class="var type0" id="S38T0U270">bxPk</span>,<span class="var type0" id="S39T0U271">byPk</span>,<span class="var type0" id="S40T0U272">wxPk</span>,<span class="var type0" id="S24T0U273">refW</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,182" id="srcline182">182</a></span><span class="line">  <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,183" id="srcline183">183</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="43,184" id="srcline184">184</a></span><span class="line">  scalePlot(<span class="var type0" id="S50T0U277">hAxes</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,185" id="srcline185">185</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,186" id="srcline186">186</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,187" id="srcline187">187</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
</pre>
