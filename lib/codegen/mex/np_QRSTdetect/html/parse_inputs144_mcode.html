<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="43,186" id="srcline186">186</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,187" id="srcline187">187</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,188" id="srcline188">188</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S55T2U280">y</span>,<span class="var type1" id="S56T6U281">yIsRow</span>,<span class="var type1" id="S57T5U282">x</span>,<span class="var type1" id="S58T6U283">xIsRow</span>,<span class="var type0" id="S59T0U284">Ph</span>,<span class="var type0" id="S60T0U285">Pp</span>,<span class="var type0" id="S61T0U286">Wmin</span>,<span class="var type0" id="S62T0U287">Wmax</span>,<span class="var type0" id="S63T0U288">Pd</span>,<span class="var type0" id="S64T0U289">Th</span>,<span class="var type0" id="S65T0U290">NpOut</span>,<span class="var type0" id="S66T0U291">Str</span>,<span class="var type0" id="S67T0U292">Ann</span>,<span class="var type0" id="S68T0U293">Ref</span>] = parse_inputs(<span class="var type1" id="S69T2U296">Yin</span>,<span class="var type1" id="S70T21U297">varargin</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,189" id="srcline189">189</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,190" id="srcline190">190</a></span><span class="line"><span class="comment">% Validate input signal</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,191" id="srcline191">191</a></span><span class="line">validateattributes(<span class="var type1" id="S69T2U301">Yin</span>,{<span class="string">'numeric'</span>},{<span class="string">'nonempty'</span>,<span class="string">'real'</span>,<span class="string">'vector'</span>},<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,192" id="srcline192">192</a></span><span class="line">    <span class="string">'findpeaks'</span>,<span class="string">'Y'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,193" id="srcline193">193</a></span><span class="line"><span class="mxinfo " id="T6:U8"><span class="var type1" id="S56T6U314">yIsRow</span> = <span class="mxinfo " id="T6:U10">isrow(<span class="var type1" id="S69T2U317">Yin</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,194" id="srcline194">194</a></span><span class="line"><span class="mxinfo " id="T2:U12"><span class="var type1" id="S55T2U320">y</span> = <span class="mxinfo " id="T2:U14"><span class="var type1" id="S69T2U322">Yin</span>(:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,195" id="srcline195">195</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,196" id="srcline196">196</a></span><span class="line"><span class="comment">% copy over orientation of y to x.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,197" id="srcline197">197</a></span><span class="line"><span class="var type0" id="S58T0U326">xIsRow</span> = <span class="var type1" id="S56T6U327">yIsRow</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,198" id="srcline198">198</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,199" id="srcline199">199</a></span><span class="line"><span class="comment">% indicate if the user specified an Fs or X</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,200" id="srcline200">200</a></span><span class="line"><span class="mxinfo " id="T6:U17"><span class="var type1" id="S73T6U330">hasX</span> = <span class="mxinfo " id="T6:U19">~isempty(<span class="mxinfo " id="T21:U20"><span class="var type1" id="S70T21U335"><span class="message error" id="M11F144C">varargin</span></span></span>) &amp;&amp; (isnumeric(<span class="mxinfo " id="T12:U21"><span class="var type1" id="S70T21U341">varargin</span>{1}</span>) || <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,201" id="srcline201">201</a></span><span class="line">  coder.target(<span class="string">'MATLAB'</span>) &amp;&amp; isdatetime(<span class="var type0" id="S70T0U353">varargin</span>{1}) &amp;&amp; numel(<span class="var type0" id="S70T0U359">varargin</span>{1})&gt;1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,202" id="srcline202">202</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,203" id="srcline203">203</a></span><span class="line"><span class="keyword">if</span> <span class="var type1" id="S73T6U364">hasX</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,204" id="srcline204">204</a></span><span class="line">  <span class="var type0" id="S79T0U367">startArg</span> = 2;</span></span>
<span class="srcline"><span class="lineno"><a href="43,205" id="srcline205">205</a></span><span class="line">  <span class="keyword">if</span> isscalar(<span class="var type0" id="S70T0U374">varargin</span>{1})</span></span>
<span class="srcline"><span class="lineno"><a href="43,206" id="srcline206">206</a></span><span class="line">    <span class="comment">% Fs</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,207" id="srcline207">207</a></span><span class="line">    <span class="var type0" id="S81T0U378">Fs</span> = <span class="var type0" id="S70T0U380">varargin</span>{1};</span></span>
<span class="srcline"><span class="lineno"><a href="43,208" id="srcline208">208</a></span><span class="line">    validateattributes(<span class="var type0" id="S81T0U385">Fs</span>,{<span class="string">'double'</span>},{<span class="string">'real'</span>,<span class="string">'finite'</span>,<span class="string">'positive'</span>},<span class="string">'findpeaks'</span>,<span class="string">'Fs'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,209" id="srcline209">209</a></span><span class="line">    <span class="var type0" id="S57T0U398">x</span> = (0:numel(<span class="var type0" id="S55T0U407">y</span>)-1).'/<span class="var type0" id="S81T0U409">Fs</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,210" id="srcline210">210</a></span><span class="line">  <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,211" id="srcline211">211</a></span><span class="line">    <span class="comment">% X</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,212" id="srcline212">212</a></span><span class="line">    <span class="var type0" id="S82T0U413">Xin</span> = <span class="var type0" id="S70T0U415">varargin</span>{1};</span></span>
<span class="srcline"><span class="lineno"><a href="43,213" id="srcline213">213</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="43,214" id="srcline214">214</a></span><span class="line">    <span class="keyword">if</span> isnumeric(<span class="var type0" id="S82T0U421">Xin</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,215" id="srcline215">215</a></span><span class="line">      validateattributes(<span class="var type0" id="S82T0U425">Xin</span>,{<span class="string">'double'</span>},{<span class="string">'real'</span>,<span class="string">'finite'</span>,<span class="string">'vector'</span>,<span class="string">'increasing'</span>},<span class="string">'findpeaks'</span>,<span class="string">'X'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,216" id="srcline216">216</a></span><span class="line">    <span class="keyword">else</span> <span class="comment">% isdatetime(Xin)</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,217" id="srcline217">217</a></span><span class="line">      validateattributes(seconds(<span class="var type0" id="S82T0U444">Xin</span>-<span class="var type0" id="S82T0U446">Xin</span>(1)),{<span class="string">'double'</span>},{<span class="string">'real'</span>,<span class="string">'finite'</span>,<span class="string">'vector'</span>,<span class="string">'increasing'</span>},<span class="string">'findpeaks'</span>,<span class="string">'X'</span>);      </span></span>
<span class="srcline"><span class="lineno"><a href="43,218" id="srcline218">218</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,219" id="srcline219">219</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="43,220" id="srcline220">220</a></span><span class="line">    <span class="keyword">if</span> numel(<span class="var type0" id="S82T0U464">Xin</span>) ~= numel(<span class="var type0" id="S69T0U467">Yin</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,221" id="srcline221">221</a></span><span class="line">      <span class="keyword">if</span> coder.target(<span class="string">'MATLAB'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,222" id="srcline222">222</a></span><span class="line">        throwAsCaller(MException(message(<span class="string">'signal:findpeaks:mismatchYX'</span>)));</span></span>
<span class="srcline"><span class="lineno"><a href="43,223" id="srcline223">223</a></span><span class="line">      <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,224" id="srcline224">224</a></span><span class="line">        coder.internal.errorIf(true,<span class="string">'signal:findpeaks:mismatchYX'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,225" id="srcline225">225</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,226" id="srcline226">226</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,227" id="srcline227">227</a></span><span class="line">    <span class="var type0" id="S58T0U496">xIsRow</span> = isrow(<span class="var type0" id="S82T0U499">Xin</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,228" id="srcline228">228</a></span><span class="line">    <span class="var type0" id="S57T0U502">x</span> = <span class="var type0" id="S82T0U504">Xin</span>(:);</span></span>
<span class="srcline"><span class="lineno"><a href="43,229" id="srcline229">229</a></span><span class="line">  <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,230" id="srcline230">230</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,231" id="srcline231">231</a></span><span class="line">  <span class="var type0" id="S79T0U509">startArg</span> = <span class="mxinfo " id="T4:U24">1</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,232" id="srcline232">232</a></span><span class="line">  <span class="comment">% unspecified, use index vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,233" id="srcline233">233</a></span><span class="line">  <span class="var type0" id="S57T0U513">x</span> = <span class="mxinfo " id="T5:U25">(<span class="mxinfo " id="T7:U26">1:<span class="mxinfo " id="T37:U27">numel(<span class="var type1" id="S55T2U520">y</span>)</span></span>).'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,234" id="srcline234">234</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,235" id="srcline235">235</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,236" id="srcline236">236</a></span><span class="line"><span class="keyword">if</span> coder.target(<span class="string">'MATLAB'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,237" id="srcline237">237</a></span><span class="line">    <span class="keyword">try</span> <span class="comment">%#ok&lt;EMTC&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,238" id="srcline238">238</a></span><span class="line">        <span class="comment">% Check the input data type. Single precision is not supported.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,239" id="srcline239">239</a></span><span class="line">        chkinputdatatype(<span class="var type0" id="S55T0U532">y</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,240" id="srcline240">240</a></span><span class="line">        <span class="keyword">if</span> isnumeric(<span class="var type0" id="S57T0U537">x</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,241" id="srcline241">241</a></span><span class="line">          chkinputdatatype(<span class="var type0" id="S57T0U541">x</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,242" id="srcline242">242</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,243" id="srcline243">243</a></span><span class="line">    <span class="keyword">catch</span> <span class="var type0" id="S89T0U543">ME</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,244" id="srcline244">244</a></span><span class="line">        throwAsCaller(<span class="var type0" id="S89T0U547">ME</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,245" id="srcline245">245</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,246" id="srcline246">246</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,247" id="srcline247">247</a></span><span class="line">    <span class="message error" id="M10F144C"><span class="fcn" id="F183N2:B551">chkinputdatatype</span>(<span class="var type1" id="S55T2U552">y</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,248" id="srcline248">248</a></span><span class="line">    chkinputdatatype(<span class="var type0" id="S57T0U556">x</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,249" id="srcline249">249</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,250" id="srcline250">250</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,251" id="srcline251">251</a></span><span class="line"><span class="var type0" id="S90T0U559">M</span> = numel(<span class="var type0" id="S55T0U562">y</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,252" id="srcline252">252</a></span><span class="line"><span class="var type0" id="S91T0U565">cond</span> = (<span class="var type0" id="S90T0U568">M</span> &lt; 3);</span></span>
<span class="srcline"><span class="lineno"><a href="43,253" id="srcline253">253</a></span><span class="line"><span class="keyword">if</span> <span class="var type0" id="S91T0U572">cond</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,254" id="srcline254">254</a></span><span class="line">    coder.internal.errorIf(<span class="var type0" id="S91T0U580">cond</span>,<span class="string">'signal:findpeaks:emptyDataSet'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,255" id="srcline255">255</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,256" id="srcline256">256</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,257" id="srcline257">257</a></span><span class="line"><span class="comment">%#function dspopts.findpeaks</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,258" id="srcline258">258</a></span><span class="line"><span class="var type0" id="S92T0U584">defaultMinPeakHeight</span> = -inf;</span></span>
<span class="srcline"><span class="lineno"><a href="43,259" id="srcline259">259</a></span><span class="line"><span class="var type0" id="S94T0U590">defaultMinPeakProminence</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="43,260" id="srcline260">260</a></span><span class="line"><span class="var type0" id="S95T0U594">defaultMinPeakWidth</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="43,261" id="srcline261">261</a></span><span class="line"><span class="var type0" id="S96T0U598">defaultMaxPeakWidth</span> = Inf;</span></span>
<span class="srcline"><span class="lineno"><a href="43,262" id="srcline262">262</a></span><span class="line"><span class="var type0" id="S98T0U603">defaultMinPeakDistance</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="43,263" id="srcline263">263</a></span><span class="line"><span class="var type0" id="S99T0U607">defaultThreshold</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="43,264" id="srcline264">264</a></span><span class="line"><span class="var type0" id="S100T0U611">defaultNPeaks</span> = [];</span></span>
<span class="srcline"><span class="lineno"><a href="43,265" id="srcline265">265</a></span><span class="line"><span class="var type0" id="S101T0U616">defaultSortStr</span> = <span class="string">'none'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,266" id="srcline266">266</a></span><span class="line"><span class="var type0" id="S102T0U620">defaultAnnotate</span> = <span class="string">'peaks'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,267" id="srcline267">267</a></span><span class="line"><span class="var type0" id="S103T0U624">defaultWidthReference</span> = <span class="string">'halfprom'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,268" id="srcline268">268</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,269" id="srcline269">269</a></span><span class="line"><span class="keyword">if</span> coder.target(<span class="string">'MATLAB'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,270" id="srcline270">270</a></span><span class="line">    <span class="var type0" id="S104T0U635">p</span> = inputParser;</span></span>
<span class="srcline"><span class="lineno"><a href="43,271" id="srcline271">271</a></span><span class="line">    addParameter(<span class="var type0" id="S104T0U641">p</span>,<span class="string">'MinPeakHeight'</span>,<span class="var type0" id="S92T0U643">defaultMinPeakHeight</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,272" id="srcline272">272</a></span><span class="line">    addParameter(<span class="var type0" id="S104T0U647">p</span>,<span class="string">'MinPeakProminence'</span>,<span class="var type0" id="S94T0U649">defaultMinPeakProminence</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,273" id="srcline273">273</a></span><span class="line">    addParameter(<span class="var type0" id="S104T0U653">p</span>,<span class="string">'MinPeakWidth'</span>,<span class="var type0" id="S95T0U655">defaultMinPeakWidth</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,274" id="srcline274">274</a></span><span class="line">    addParameter(<span class="var type0" id="S104T0U659">p</span>,<span class="string">'MaxPeakWidth'</span>,<span class="var type0" id="S96T0U661">defaultMaxPeakWidth</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,275" id="srcline275">275</a></span><span class="line">    addParameter(<span class="var type0" id="S104T0U665">p</span>,<span class="string">'MinPeakDistance'</span>,<span class="var type0" id="S98T0U667">defaultMinPeakDistance</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,276" id="srcline276">276</a></span><span class="line">    addParameter(<span class="var type0" id="S104T0U671">p</span>,<span class="string">'Threshold'</span>,<span class="var type0" id="S99T0U673">defaultThreshold</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,277" id="srcline277">277</a></span><span class="line">    addParameter(<span class="var type0" id="S104T0U677">p</span>,<span class="string">'NPeaks'</span>,<span class="var type0" id="S100T0U679">defaultNPeaks</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,278" id="srcline278">278</a></span><span class="line">    addParameter(<span class="var type0" id="S104T0U683">p</span>,<span class="string">'SortStr'</span>,<span class="var type0" id="S101T0U685">defaultSortStr</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,279" id="srcline279">279</a></span><span class="line">    addParameter(<span class="var type0" id="S104T0U689">p</span>,<span class="string">'Annotate'</span>,<span class="var type0" id="S102T0U691">defaultAnnotate</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,280" id="srcline280">280</a></span><span class="line">    addParameter(<span class="var type0" id="S104T0U695">p</span>,<span class="string">'WidthReference'</span>,<span class="var type0" id="S103T0U697">defaultWidthReference</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,281" id="srcline281">281</a></span><span class="line">    parse(<span class="var type0" id="S104T0U701">p</span>,<span class="var type0" id="S70T0U703">varargin</span>{<span class="var type0" id="S79T0U705">startArg</span>:end});</span></span>
<span class="srcline"><span class="lineno"><a href="43,282" id="srcline282">282</a></span><span class="line">    <span class="var type0" id="S59T0U710">Ph</span> = <span class="var type0" id="S104T0U713">p</span>.Results.MinPeakHeight;</span></span>
<span class="srcline"><span class="lineno"><a href="43,283" id="srcline283">283</a></span><span class="line">    <span class="var type0" id="S60T0U718">Pp</span> = <span class="var type0" id="S104T0U721">p</span>.Results.MinPeakProminence;</span></span>
<span class="srcline"><span class="lineno"><a href="43,284" id="srcline284">284</a></span><span class="line">    <span class="var type0" id="S61T0U726">Wmin</span> = <span class="var type0" id="S104T0U729">p</span>.Results.MinPeakWidth;</span></span>
<span class="srcline"><span class="lineno"><a href="43,285" id="srcline285">285</a></span><span class="line">    <span class="var type0" id="S62T0U734">Wmax</span> = <span class="var type0" id="S104T0U737">p</span>.Results.MaxPeakWidth;</span></span>
<span class="srcline"><span class="lineno"><a href="43,286" id="srcline286">286</a></span><span class="line">    <span class="var type0" id="S63T0U742">Pd</span> = <span class="var type0" id="S104T0U745">p</span>.Results.MinPeakDistance;</span></span>
<span class="srcline"><span class="lineno"><a href="43,287" id="srcline287">287</a></span><span class="line">    <span class="var type0" id="S64T0U750">Th</span> = <span class="var type0" id="S104T0U753">p</span>.Results.Threshold;</span></span>
<span class="srcline"><span class="lineno"><a href="43,288" id="srcline288">288</a></span><span class="line">    <span class="var type0" id="S109T0U758">Np</span> = <span class="var type0" id="S104T0U761">p</span>.Results.NPeaks;</span></span>
<span class="srcline"><span class="lineno"><a href="43,289" id="srcline289">289</a></span><span class="line">    <span class="var type0" id="S66T0U766">Str</span> = <span class="var type0" id="S104T0U769">p</span>.Results.SortStr;</span></span>
<span class="srcline"><span class="lineno"><a href="43,290" id="srcline290">290</a></span><span class="line">    <span class="var type0" id="S67T0U774">Ann</span> = <span class="var type0" id="S104T0U777">p</span>.Results.Annotate;</span></span>
<span class="srcline"><span class="lineno"><a href="43,291" id="srcline291">291</a></span><span class="line">    <span class="var type0" id="S68T0U782">Ref</span> = <span class="var type0" id="S104T0U785">p</span>.Results.WidthReference;</span></span>
<span class="srcline"><span class="lineno"><a href="43,292" id="srcline292">292</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,293" id="srcline293">293</a></span><span class="line">    <span class="var type0" id="S110T0U791">parms</span> = struct(<span class="string">'MinPeakHeight'</span>,uint32(0), <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,294" id="srcline294">294</a></span><span class="line">                <span class="string">'MinPeakProminence'</span>,uint32(0), <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,295" id="srcline295">295</a></span><span class="line">                <span class="string">'MinPeakWidth'</span>,uint32(0), <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,296" id="srcline296">296</a></span><span class="line">                <span class="string">'MaxPeakWidth'</span>,uint32(0), <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,297" id="srcline297">297</a></span><span class="line">                <span class="string">'MinPeakDistance'</span>,uint32(0), <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,298" id="srcline298">298</a></span><span class="line">                <span class="string">'Threshold'</span>,uint32(0), <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,299" id="srcline299">299</a></span><span class="line">                <span class="string">'NPeaks'</span>,uint32(0), <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,300" id="srcline300">300</a></span><span class="line">                <span class="string">'SortStr'</span>,uint32(0), <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,301" id="srcline301">301</a></span><span class="line">                <span class="string">'Annotate'</span>,uint32(0), <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,302" id="srcline302">302</a></span><span class="line">                <span class="string">'WidthReference'</span>,uint32(0));</span></span>
<span class="srcline"><span class="lineno"><a href="43,303" id="srcline303">303</a></span><span class="line">    <span class="var type0" id="S113T0U836">pstruct</span> = eml_parse_parameter_inputs(<span class="var type0" id="S110T0U839">parms</span>,[],<span class="var type0" id="S70T0U843">varargin</span>{<span class="var type0" id="S79T0U845">startArg</span>:end});</span></span>
<span class="srcline"><span class="lineno"><a href="43,304" id="srcline304">304</a></span><span class="line">    <span class="var type0" id="S59T0U850">Ph</span> = eml_get_parameter_value(<span class="var type0" id="S113T0U854">pstruct</span>.MinPeakHeight,<span class="var type0" id="S92T0U856">defaultMinPeakHeight</span>,<span class="var type0" id="S70T0U858">varargin</span>{<span class="var type0" id="S79T0U860">startArg</span>:end});</span></span>
<span class="srcline"><span class="lineno"><a href="43,305" id="srcline305">305</a></span><span class="line">    <span class="var type0" id="S60T0U865">Pp</span> = eml_get_parameter_value(<span class="var type0" id="S113T0U869">pstruct</span>.MinPeakProminence,<span class="var type0" id="S94T0U871">defaultMinPeakProminence</span>,<span class="var type0" id="S70T0U873">varargin</span>{<span class="var type0" id="S79T0U875">startArg</span>:end});</span></span>
<span class="srcline"><span class="lineno"><a href="43,306" id="srcline306">306</a></span><span class="line">    <span class="var type0" id="S61T0U880">Wmin</span> = eml_get_parameter_value(<span class="var type0" id="S113T0U884">pstruct</span>.MinPeakWidth,<span class="var type0" id="S95T0U886">defaultMinPeakWidth</span>,<span class="var type0" id="S70T0U888">varargin</span>{<span class="var type0" id="S79T0U890">startArg</span>:end});</span></span>
<span class="srcline"><span class="lineno"><a href="43,307" id="srcline307">307</a></span><span class="line">    <span class="var type0" id="S62T0U895">Wmax</span> = eml_get_parameter_value(<span class="var type0" id="S113T0U899">pstruct</span>.MaxPeakWidth,<span class="var type0" id="S96T0U901">defaultMaxPeakWidth</span>,<span class="var type0" id="S70T0U903">varargin</span>{<span class="var type0" id="S79T0U905">startArg</span>:end});</span></span>
<span class="srcline"><span class="lineno"><a href="43,308" id="srcline308">308</a></span><span class="line">    <span class="var type0" id="S63T0U910">Pd</span> = eml_get_parameter_value(<span class="var type0" id="S113T0U914">pstruct</span>.MinPeakDistance,<span class="var type0" id="S98T0U916">defaultMinPeakDistance</span>,<span class="var type0" id="S70T0U918">varargin</span>{<span class="var type0" id="S79T0U920">startArg</span>:end});</span></span>
<span class="srcline"><span class="lineno"><a href="43,309" id="srcline309">309</a></span><span class="line">    <span class="var type0" id="S64T0U925">Th</span> = eml_get_parameter_value(<span class="var type0" id="S113T0U929">pstruct</span>.Threshold,<span class="var type0" id="S99T0U931">defaultThreshold</span>,<span class="var type0" id="S70T0U933">varargin</span>{<span class="var type0" id="S79T0U935">startArg</span>:end});</span></span>
<span class="srcline"><span class="lineno"><a href="43,310" id="srcline310">310</a></span><span class="line">    <span class="var type0" id="S109T0U940">Np</span> = eml_get_parameter_value(<span class="var type0" id="S113T0U944">pstruct</span>.NPeaks,<span class="var type0" id="S100T0U946">defaultNPeaks</span>,<span class="var type0" id="S70T0U948">varargin</span>{<span class="var type0" id="S79T0U950">startArg</span>:end});</span></span>
<span class="srcline"><span class="lineno"><a href="43,311" id="srcline311">311</a></span><span class="line">    <span class="var type0" id="S66T0U955">Str</span> = eml_get_parameter_value(<span class="var type0" id="S113T0U959">pstruct</span>.SortStr,<span class="var type0" id="S101T0U961">defaultSortStr</span>,<span class="var type0" id="S70T0U963">varargin</span>{<span class="var type0" id="S79T0U965">startArg</span>:end});</span></span>
<span class="srcline"><span class="lineno"><a href="43,312" id="srcline312">312</a></span><span class="line">    <span class="var type0" id="S67T0U970">Ann</span> = eml_get_parameter_value(<span class="var type0" id="S113T0U974">pstruct</span>.Annotate,<span class="var type0" id="S102T0U976">defaultAnnotate</span>,<span class="var type0" id="S70T0U978">varargin</span>{<span class="var type0" id="S79T0U980">startArg</span>:end});</span></span>
<span class="srcline"><span class="lineno"><a href="43,313" id="srcline313">313</a></span><span class="line">    <span class="var type0" id="S68T0U985">Ref</span> = eml_get_parameter_value(<span class="var type0" id="S113T0U989">pstruct</span>.WidthReference,<span class="var type0" id="S103T0U991">defaultWidthReference</span>,<span class="var type0" id="S70T0U993">varargin</span>{<span class="var type0" id="S79T0U995">startArg</span>:end});</span></span>
<span class="srcline"><span class="lineno"><a href="43,314" id="srcline314">314</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,315" id="srcline315">315</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,316" id="srcline316">316</a></span><span class="line"><span class="comment">% limit the number of peaks to the number of input samples</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,317" id="srcline317">317</a></span><span class="line"><span class="keyword">if</span> isempty(<span class="var type0" id="S109T0U1002">Np</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,318" id="srcline318">318</a></span><span class="line">    <span class="var type0" id="S65T0U1005">NpOut</span> = <span class="var type0" id="S90T0U1006">M</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,319" id="srcline319">319</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,320" id="srcline320">320</a></span><span class="line">    <span class="var type0" id="S65T0U1010">NpOut</span> = <span class="var type0" id="S109T0U1011">Np</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,321" id="srcline321">321</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,322" id="srcline322">322</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,323" id="srcline323">323</a></span><span class="line"><span class="comment">% ignore peaks below zero when using halfheight width reference</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,324" id="srcline324">324</a></span><span class="line"><span class="keyword">if</span> strcmp(<span class="var type0" id="S68T0U1016">Ref</span>,<span class="string">'halfheight'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,325" id="srcline325">325</a></span><span class="line">  <span class="var type0" id="S59T0U1020">Ph</span> = max(<span class="var type0" id="S59T0U1023">Ph</span>,0);</span></span>
<span class="srcline"><span class="lineno"><a href="43,326" id="srcline326">326</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,327" id="srcline327">327</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,328" id="srcline328">328</a></span><span class="line">validateattributes(<span class="var type0" id="S59T0U1028">Ph</span>,{<span class="string">'numeric'</span>},{<span class="string">'real'</span>,<span class="string">'scalar'</span>,<span class="string">'nonempty'</span>},<span class="string">'findpeaks'</span>,<span class="string">'MinPeakHeight'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,329" id="srcline329">329</a></span><span class="line"><span class="keyword">if</span> isnumeric(<span class="var type0" id="S57T0U1043">x</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,330" id="srcline330">330</a></span><span class="line">  validateattributes(<span class="var type0" id="S63T0U1047">Pd</span>,{<span class="string">'numeric'</span>},{<span class="string">'real'</span>,<span class="string">'scalar'</span>,<span class="string">'nonempty'</span>,<span class="string">'nonnegative'</span>,<span class="string">'&lt;'</span>,<span class="var type0" id="S57T0U1060">x</span>(<span class="var type0" id="S90T0U1061">M</span>)-<span class="var type0" id="S57T0U1063">x</span>(1)},<span class="string">'findpeaks'</span>,<span class="string">'MinPeakDistance'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,331" id="srcline331">331</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,332" id="srcline332">332</a></span><span class="line">  <span class="keyword">if</span> coder.target(<span class="string">'MATLAB'</span>) &amp;&amp; isduration(<span class="var type0" id="S63T0U1078">Pd</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,333" id="srcline333">333</a></span><span class="line">    validateattributes(seconds(<span class="var type0" id="S63T0U1084">Pd</span>),{<span class="string">'numeric'</span>},{<span class="string">'real'</span>,<span class="string">'scalar'</span>,<span class="string">'nonempty'</span>,<span class="string">'nonnegative'</span>},<span class="string">'findpeaks'</span>,<span class="string">'MinPeakDistance'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,334" id="srcline334">334</a></span><span class="line">  <span class="keyword">else</span> </span></span>
<span class="srcline"><span class="lineno"><a href="43,335" id="srcline335">335</a></span><span class="line">    validateattributes(<span class="var type0" id="S63T0U1100">Pd</span>,{<span class="string">'numeric'</span>},{<span class="string">'real'</span>,<span class="string">'scalar'</span>,<span class="string">'nonempty'</span>,<span class="string">'nonnegative'</span>},<span class="string">'findpeaks'</span>,<span class="string">'MinPeakDistance'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,336" id="srcline336">336</a></span><span class="line">  <span class="keyword">end</span>    </span></span>
<span class="srcline"><span class="lineno"><a href="43,337" id="srcline337">337</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,338" id="srcline338">338</a></span><span class="line">validateattributes(<span class="var type0" id="S60T0U1115">Pp</span>,{<span class="string">'numeric'</span>},{<span class="string">'real'</span>,<span class="string">'scalar'</span>,<span class="string">'nonempty'</span>,<span class="string">'nonnegative'</span>},<span class="string">'findpeaks'</span>,<span class="string">'MinPeakProminence'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,339" id="srcline339">339</a></span><span class="line"><span class="keyword">if</span> coder.target(<span class="string">'MATLAB'</span>) &amp;&amp; isduration(<span class="var type0" id="S61T0U1137">Wmin</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,340" id="srcline340">340</a></span><span class="line">  validateattributes(seconds(<span class="var type0" id="S61T0U1143">Wmin</span>),{<span class="string">'numeric'</span>},{<span class="string">'real'</span>,<span class="string">'scalar'</span>,<span class="string">'finite'</span>,<span class="string">'nonempty'</span>,<span class="string">'nonnegative'</span>},<span class="string">'findpeaks'</span>,<span class="string">'MinPeakWidth'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,341" id="srcline341">341</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,342" id="srcline342">342</a></span><span class="line">  validateattributes(<span class="var type0" id="S61T0U1160">Wmin</span>,{<span class="string">'numeric'</span>},{<span class="string">'real'</span>,<span class="string">'scalar'</span>,<span class="string">'finite'</span>,<span class="string">'nonempty'</span>,<span class="string">'nonnegative'</span>},<span class="string">'findpeaks'</span>,<span class="string">'MinPeakWidth'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,343" id="srcline343">343</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,344" id="srcline344">344</a></span><span class="line"><span class="keyword">if</span> coder.target(<span class="string">'MATLAB'</span>) &amp;&amp; isduration(<span class="var type0" id="S62T0U1183">Wmax</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,345" id="srcline345">345</a></span><span class="line">  validateattributes(seconds(<span class="var type0" id="S62T0U1189">Wmax</span>),{<span class="string">'numeric'</span>},{<span class="string">'real'</span>,<span class="string">'scalar'</span>,<span class="string">'nonnan'</span>,<span class="string">'nonempty'</span>,<span class="string">'nonnegative'</span>},<span class="string">'findpeaks'</span>,<span class="string">'MaxPeakWidth'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,346" id="srcline346">346</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,347" id="srcline347">347</a></span><span class="line">  validateattributes(<span class="var type0" id="S62T0U1206">Wmax</span>,{<span class="string">'numeric'</span>},{<span class="string">'real'</span>,<span class="string">'scalar'</span>,<span class="string">'nonnan'</span>,<span class="string">'nonempty'</span>,<span class="string">'nonnegative'</span>},<span class="string">'findpeaks'</span>,<span class="string">'MaxPeakWidth'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,348" id="srcline348">348</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,349" id="srcline349">349</a></span><span class="line"><span class="keyword">if</span> coder.target(<span class="string">'MATLAB'</span>) &amp;&amp; isduration(<span class="var type0" id="S63T0U1229">Pd</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,350" id="srcline350">350</a></span><span class="line">  validateattributes(seconds(<span class="var type0" id="S63T0U1235">Pd</span>),{<span class="string">'numeric'</span>},{<span class="string">'real'</span>,<span class="string">'scalar'</span>,<span class="string">'nonempty'</span>,<span class="string">'nonnegative'</span>},<span class="string">'findpeaks'</span>,<span class="string">'MinPeakDistance'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,351" id="srcline351">351</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,352" id="srcline352">352</a></span><span class="line">  validateattributes(<span class="var type0" id="S63T0U1251">Pd</span>,{<span class="string">'numeric'</span>},{<span class="string">'real'</span>,<span class="string">'scalar'</span>,<span class="string">'nonempty'</span>,<span class="string">'nonnegative'</span>},<span class="string">'findpeaks'</span>,<span class="string">'MinPeakDistance'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,353" id="srcline353">353</a></span><span class="line"><span class="keyword">end</span>  </span></span>
<span class="srcline"><span class="lineno"><a href="43,354" id="srcline354">354</a></span><span class="line">validateattributes(<span class="var type0" id="S64T0U1266">Th</span>,{<span class="string">'numeric'</span>},{<span class="string">'real'</span>,<span class="string">'scalar'</span>,<span class="string">'nonempty'</span>,<span class="string">'nonnegative'</span>},<span class="string">'findpeaks'</span>,<span class="string">'Threshold'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,355" id="srcline355">355</a></span><span class="line">validateattributes(<span class="var type0" id="S65T0U1281">NpOut</span>,{<span class="string">'numeric'</span>},{<span class="string">'real'</span>,<span class="string">'scalar'</span>,<span class="string">'nonempty'</span>,<span class="string">'integer'</span>,<span class="string">'positive'</span>},<span class="string">'findpeaks'</span>,<span class="string">'NPeaks'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,356" id="srcline356">356</a></span><span class="line"><span class="var type0" id="S66T0U1296">Str</span> = validatestring(<span class="var type0" id="S66T0U1299">Str</span>,{<span class="string">'ascend'</span>,<span class="string">'none'</span>,<span class="string">'descend'</span>},<span class="string">'findpeaks'</span>,<span class="string">'SortStr'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,357" id="srcline357">357</a></span><span class="line"><span class="var type0" id="S67T0U1309">Ann</span> = validatestring(<span class="var type0" id="S67T0U1312">Ann</span>,{<span class="string">'peaks'</span>,<span class="string">'extents'</span>},<span class="string">'findpeaks'</span>,<span class="string">'SortStr'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,358" id="srcline358">358</a></span><span class="line"><span class="var type0" id="S68T0U1321">Ref</span> = validatestring(<span class="var type0" id="S68T0U1324">Ref</span>,{<span class="string">'halfprom'</span>,<span class="string">'halfheight'</span>},<span class="string">'findpeaks'</span>,<span class="string">'WidthReference'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,359" id="srcline359">359</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,360" id="srcline360">360</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
</pre>
